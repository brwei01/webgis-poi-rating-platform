<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Route Planning - WebGIS</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
    
     <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    
    <!-- jQuery library -->
    <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
    
    <!-- the following links incorporate the CSS required for custom icon creation -->
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="css/leaflet.awesome-markers.css">
    <script src="js/leaflet.awesome-markers.js"></script>
    
    <title>Test HTML Location Functionality</title>
    <script src = 'js/basicMapLeaflet.js'></script>
    <script src = 'js/getLocation.js'></script>
    <script src="js/getDistance.js"></script>
    <script src = "js/trackLocation.js"></script>
    <script src = "js/getRoute.js"></script> 

    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #mapid { height: 100vh; width: 100%; }

        /* Floating Control Panel Style (right side) */
        .floating-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            max-width: 350px;
            max-height: calc(100vh - 20px);
            overflow-y: auto;
        }
        /* itinerary panel style */
        .leaflet-routing-container {
            position: fixed !important;
            left: 10px !important; /* Move to left side */
            right: auto !important;
            top: 100px !important;
            z-index: 999 !important; /* Ensure it's above other map elements */
            max-width: 1000px;
            max-width: 80vh;
            overflow-y: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }   
        /* hide Control Panel scrollbar */
        /* .leaflet-routing-container button{
            display: none;
        } */
         /* 美化滚动条 */
        .leaflet-routing-container::-webkit-scrollbar {
            width: 6px;
        }
        .leaflet-routing-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }

    </style>
</head>

<body>
    <!-- Map -->
    <div id="mapid"></div>

    <!-- Floating Control Panel -->
    <div class="floating-panel">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fa fa-route me-2"></i>Route Planning</h5>
            </div>
            <div class="card-body">
                <!-- Location Tool -->
                <div class="mb-3">
                    <label class="form-label fw-bold"><i class="fa fa-map-marker-alt me-2"></i>My Location</label>
                    <div id='showLocation' class="alert alert-info small">Location will be displayed here</div>
                    <button class="btn btn-sm btn-primary w-100" onclick='getLocation()'>
                        <i class="fa fa-crosshairs me-2"></i>Get Location
                    </button>
                </div>

                <hr>

                <!-- Distance Tool -->
                <div class="mb-3">
                    <label class="form-label fw-bold"><i class="fa fa-ruler me-2"></i>Distance</label>
                    <div id="showDistance" class="alert alert-warning small">Distance will be displayed here</div>
                    <button class="btn btn-sm btn-warning w-100" onclick="getDistance()">
                        <i class="fa fa-calculator me-2"></i>Calculate
                    </button>
                </div>

                <hr>

                <!-- Tracking Tool -->
                <!-- div class="mb-3">
                    <label class="form-label fw-bold"><i class="fa fa-satellite-dish me-2"></i>Tracking</label>
                    <button class="btn btn-sm btn-success w-100" onclick='trackLocation()'>
                        <i class="fa fa-broadcast-tower me-2"></i>Start Tracking
                    </button>
                </div-->


                <!--  新增：routing 信息显示区域 -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Route Info</label>
                    <div id="routeInfo" class="alert alert-secondary small">
                        Click on assets to plan your route
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    "use strict";
    document.addEventListener('DOMContentLoaded', function() {
        loadMap();
    });
        
    function loadMap() {
        if (typeof mymap !== 'undefined' && mymap != null){
            mymap.remove();
        }   
        loadLeafletMap();
        setMapClickEventRouting();
    }
    </script>
</body>
</html>